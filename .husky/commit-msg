#!/bin/sh

# Strict Gitmoji + Conventional Commits validator
# REQUIRED format: [gitmoji] [type](scope?): [subject starting with lowercase]
# Examples:
#   âœ¨ feat: add new feature
#   ğŸ› fix(auth): resolve login issue  
#   ğŸ“ docs: update readme file
#   ğŸ¨ style: improve code formatting

MSG_FILE="$1"
if [ -z "$MSG_FILE" ]; then
  echo "No commit message file supplied"
  exit 1
fi

MSG=$(cat "$MSG_FILE")

# Common gitmoji patterns (expand as needed)
GITMOJI_PATTERN="[âœ¨ğŸ›ğŸ”§ğŸ“ğŸ¨ğŸš€ğŸ”¥ğŸ’šğŸ‘·ğŸ”’â¬†ï¸â¬‡ï¸ğŸ“ŒğŸ‰ğŸ”–ğŸš¨ğŸ’„â™»ï¸ğŸ”¨ğŸŒğŸ’¡ğŸ—ƒï¸ğŸ—ï¸ğŸ“±âš¡ğŸ±â™¿ğŸ”ŠğŸ”‡ğŸƒğŸ©¹ğŸ§âš°ï¸ğŸ§ªğŸ‘”ğŸ©ºğŸ”ğŸ·ï¸ğŸŒ±ğŸš©ğŸ¥…ğŸ’«ğŸ—‘ï¸ğŸ”€]"

# Strict regex: gitmoji + space + type + optional(scope) + colon + space + lowercase subject
echo "$MSG" | grep -Eq "^${GITMOJI_PATTERN} (feat|fix|docs|chore|perf|refactor|style|test|build|ci|config|merge)(\([^)]+\))?: [a-z]"

if [ $? -ne 0 ]; then
  echo "\nâœ˜ Commit message must follow the STRICT gitmoji + conventional commits format."
  echo ""
  echo "ğŸ“‹ Required format: [gitmoji] [type](scope?): [subject]"
  echo ""
  echo "ğŸ“ Rules:"
  echo "   â€¢ Gitmoji is REQUIRED at the start"
  echo "   â€¢ Type is REQUIRED (feat|fix|docs|chore|perf|refactor|style|test|build|ci)"
  echo "   â€¢ Scope is optional: (scope)"
  echo "   â€¢ Colon and space are REQUIRED: ': '"
  echo "   â€¢ Subject MUST start with lowercase letter"
  echo ""
  echo "âœ… Valid examples:"
  echo "   âœ¨ feat: add user authentication"
  echo "   ğŸ› fix(api): handle timeout errors"
  echo "   ğŸ“ docs: update installation guide"
  echo "   ğŸ¨ style: improve component CSS"
  echo "   ğŸ”§ chore(deps): update dependencies"
  echo ""
  echo "âŒ Invalid examples:"
  echo "   feat: missing gitmoji"
  echo "   âœ¨ Add feature (missing type)"
  echo "   âœ¨ feat Add feature (missing colon)"
  echo "   âœ¨ feat: Add feature (subject starts with uppercase)"
  echo ""
  echo "ğŸ“š Common gitmoji + types:"
  echo "   âœ¨ feat    ğŸ› fix     ğŸ“ docs    ğŸ¨ style"
  echo "   ğŸš€ deploy  ğŸ”§ chore   ğŸ’š ci     ğŸ‘· build"
  echo "   ğŸ”¥ remove  â™»ï¸ refactor ğŸ”’ security â¬†ï¸ deps"
  echo ""
  exit 1
fi

exit 0
