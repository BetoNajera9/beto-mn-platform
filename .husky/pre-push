#!/bin/sh

# Pre-push hook: comprehensive checks before sharing code
echo "ğŸš€ Running pre-push validation..."

# Step 1: Type checking (already comprehensive)
echo "ğŸ” Step 1/5: Checking TypeScript types..."
pnpm -s type-check || {
  echo "âŒ Type checking failed! Fix type errors before pushing."
  exit 1
}

# Step 2: Linting (final check)
echo "ğŸ“‹ Step 2/5: Final lint check..."
pnpm -s lint || {
  echo "âŒ Linting failed! Fix code issues before pushing."
  exit 1
}

# Step 3: Build test (ensure production build works)
echo "ğŸ—ï¸  Step 3/5: Testing production build..."
pnpm -s build || {
  echo "âŒ Build failed! Fix build errors before pushing."
  exit 1
}

# Step 4: Security audit (check for vulnerabilities)
echo "ğŸ”’ Step 4/5: Running security audit..."
pnpm audit --audit-level moderate || {
  echo "âš ï¸  Security vulnerabilities found! Consider fixing before pushing."
  echo "ğŸ’¡ Run 'pnpm audit --fix' to auto-fix, or 'pnpm audit' for details."
  # Don't exit here - just warn, as some vulnerabilities might be acceptable
}

# Step 5: Dependency check (outdated packages)
echo "ğŸ“¦ Step 5/5: Checking for outdated dependencies..."
pnpm outdated || {
  echo "ğŸ’¡ Some dependencies are outdated. Consider updating them:"
  echo "   Run 'pnpm update' to update packages"
  # Don't exit here - just inform about outdated packages
}

echo "âœ… All critical pre-push checks passed! Ready to push to remote."
echo "ğŸ‰ Your code is production-ready!"
